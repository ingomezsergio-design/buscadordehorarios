<!DOCTYPE html>

<html class="h-full" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Horarios · Oct-Nov 2025 (Light + Animations)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    :root{ --bg:#f8fafc; --fg:#0f172a; --card:#ffffff; --border:#e2e8f0; --gap:8px; --pad:8px; --fs:14px; --fs-xs:11px; }
    .dark{ --bg:#0b1220; --fg:#e5e7eb; --card:#0f172a; --border:#1f2937; }
    html, body { background: var(--bg); color: var(--fg); transition: background .35s ease, color .35s ease; font-size: var(--fs); }
    .card { background: var(--card); border-color: var(--border); transition: background .35s ease, border-color .35s ease; }
    .border { border-color: var(--border) !important; }
    .bg-white\/90 { background-color: rgba(255,255,255,.90); }
    .dark .bg-white\/90 { background-color: rgba(15,23,42,.90); }

    /* Animations */
    .reveal { opacity: 0; transform: translateY(8px) scale(.98); animation: reveal .45s ease-out forwards; }
    .reveal:nth-child(1){ animation-delay: .02s } .reveal:nth-child(2){ animation-delay:.06s } .reveal:nth-child(3){ animation-delay:.10s }
    @keyframes reveal { to { opacity:1; transform: translateY(0) scale(1) } }
    .btn-shine { position: relative; overflow: hidden; }
    .btn-shine:before { content:""; position:absolute; top:0; left:-120%; width:120%; height:100%;
      background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.25) 50%, transparent 100%);
      transform: skewX(-20deg); }
    .btn-shine:hover:before { animation: shine 900ms ease; }
    @keyframes shine { to { left:120% } }
    .cell { transition: transform .12s ease, box-shadow .2s ease, background-color .25s ease; position: relative; overflow: hidden; }
    .cell:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.08); }
    .cell .r { position:absolute; border-radius:50%; transform:scale(0); opacity:.35; background:#fff; pointer-events:none; }
    .cell.ripple .r { animation:rip .5s ease-out; }
    @keyframes rip { to { transform:scale(8); opacity:0 } }
    .pop{ animation: pop .28s cubic-bezier(.2,.9,.25,1.25); }
    @keyframes pop{ 0%{ transform: scale(.96) } 60%{ transform: scale(1.02) } 100%{ transform: scale(1) } }
    .today { box-shadow: 0 0 0 2px rgba(99,102,241,.45) inset; position:relative; }
    .today:after { content:""; position:absolute; inset:-2px; border-radius:12px;
      box-shadow: 0 0 0 0 rgba(99,102,241,.35); animation: ring 1.6s ease-out infinite; }
    @keyframes ring { 0% { box-shadow: 0 0 0 0 rgba(99,102,241,.35) } 70% { box-shadow: 0 0 0 10px rgba(99,102,241,0) } 100% { box-shadow: 0 0 0 0 rgba(99,102,241,0) } }

    /* Dark-mode FIX: celdas no coloreadas usan la tarjeta del tema */
    .dark .cell:not([data-colored="1"]) {
      background: var(--card);
      color: var(--fg);
      border-color: var(--border);
    }

    /* Badge contraste en ambos temas */
    .badge { background: rgba(0,0,0,.15); }
    .dark .badge { background: rgba(255,255,255,.12); }

    /* Compact mode opcional si el contenedor es angosto */
    .compact { --gap:4px; --pad:6px; --fs:13px; --fs-xs:10px; }
    .compact .calendar-outer { max-height: 390px; overflow: auto; }
    .compact .calendar-grid { grid-template-columns: repeat(7, 1fr) !important; min-width: 0 !important; gap: 3px !important; }
    .compact .cell { border-radius: 6px; padding: var(--pad); }
    .compact .cell .text-xs { font-size: var(--fs-xs); }
    .compact .legend { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .compact .controls { grid-template-columns: 1fr !important; }
  
/* Contrast fixes: enforce dark text over light cards */
.card, .cell, .p-4, .rounded-xl { color: #0f172a; }
input, select, button, .text { color: #0f172a; }
/* Remove any tailwind dark: overrides by neutralizing .dark entirely */
.dark { all: unset; }

</style>
<style>
/* ---- Light theme enforced ---- */
html, body { background: var(--bg); color: var(--fg); }
:root{ --bg:#f8fafc; --fg:#0f172a; --card:#ffffff; --border:#e2e8f0; --brand:#1d4ed8; }
.card { background: var(--card); border:1px solid var(--border); }
.border { border-color: var(--border) !important; }

/* ---- Remove any dark overrides by neutralizing the selector ---- */
.dark { /* removed */ }

/* ---- Extra animations ---- */
@keyframes float { 0% { transform: translateY(0) } 50% { transform: translateY(-3px) } 100% { transform: translateY(0) } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: none } }
@keyframes pulseSoft { 0%,100% { opacity: .6 } 50% { opacity: 1 } }

.fade-in { opacity: 0; animation: fadeIn .45s ease forwards; }
.float { animation: float 3s ease-in-out infinite; }
.pulse-soft { animation: pulseSoft 1.2s ease-in-out infinite; }

/* ---- Loader Overlay ---- */
.loader-overlay { display: none !important;
  position: fixed; inset: 0; display: none;
  align-items: center; justify-content: center; backdrop-filter: blur(3px);
  background: rgba(255,255,255,.6); z-index: 60;
}
.loader {
  width: 56px; height: 56px; border-radius: 50%;
  border: 4px solid rgba(0,0,0,.1); border-top-color: var(--brand);
  animation: spin 900ms linear infinite;
}
@keyframes spin { to { transform: rotate(360deg) } }
.loader-text { margin-top: 12px; font-size: 14px; color: #334155; text-align:center }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}
</style></head>
<body class="h-full"><div class="loader-overlay" id="loaderOverlay"><div style="display:flex;flex-direction:column;align-items:center"><div class="loader"></div><div class="loader-text">Cargando…</div></div></div><div class="w-full text-center py-2" id="hintMes"><span class="inline-block text-sm px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-200 fade-in">Seleccioná el mes para comenzar</span></div>
<main class="max-w-6xl mx-auto p-4 sm:p-6">
<header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between mb-4 sm:mb-6 reveal">
<div>
<h1 class="text-xl sm:text-2xl font-semibold">Planificador de Horarios</h1>
<p class="text-sm opacity-70">Sólo Octubre (10) y Noviembre (11) 2025.</p>
</div>
<div class="flex items-center">
<button class="btn-shine inline-flex items-center gap-2 px-3.5 py-1.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60 shadow" id="btnBuscar">
<svg fill="none" height="18" viewbox="0 0 24 24" width="18"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"></circle><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path></svg>
<span>Buscar</span>
</button>
<button class="ml-2 sm:ml-3 inline-flex items-center gap-2 px-3 py-1.5 rounded-xl border card hover:opacity-90" id="themeToggle">
<svg fill="none" height="16" viewbox="0 0 24 24" width="16"><path d="M12 3c.132 0 .263.003.393.01A9 9 0 1 0 21 12a9.06 9.06 0 0 0-.61-3.268A7 7 0 0 1 12 3z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
<span id="themeLabel">Oscuro</span>
</button>
</div>
</header>
<!-- Filtros -->
<section class="grid controls grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-4 sm:mb-6">
<div class="p-3 sm:p-4 rounded-xl border card bg-white/90 backdrop-blur reveal">
<label class="block text-sm opacity-70 mb-1">Agente</label>
<input class="w-full px-2.5 py-1.5 rounded-xl border" disabled="" id="listaAgentesValor" list="listaAgentes" placeholder="Seleccioná el mes…"/>
<datalist id="listaAgentes"></datalist>
</div>
<div class="p-3 sm:p-4 rounded-xl border card bg-white/90 backdrop-blur reveal">
<label class="block text-sm opacity-70 mb-1">Mes</label>
<select class="w-full px-2.5 py-1.5 rounded-xl border" id="mes">
<option value="0">Seleccionar…</option>
<option value="10">Octubre</option>
<option value="11">Noviembre</option>
</select>
</div>
<div class="p-3 sm:p-4 rounded-xl border card bg-white/90 backdrop-blur reveal">
<p class="text-sm opacity-70">Detalles</p>
<div class="mt-2 grid grid-cols-3 gap-3 text-sm">
<div><p class="opacity-60 text-xs">Sup</p><p class="font-medium" id="card_sup">—</p></div>
<div><p class="opacity-60 text-xs">Score</p><p class="font-medium" id="card_score">—</p></div>
<div><p class="opacity-60 text-xs">Contrato</p><p class="font-medium" id="card_contrato">—</p></div>
</div>
</div>
</section>
<!-- Calendario -->
<section class="space-y-3 mb-4 hidden reveal" id="panelCalendario">
<div class="rounded-xl border card p-2 sm:p-3 bg-white/90 backdrop-blur shadow">
<div class="grid grid-cols-7 text-center text-xs font-semibold opacity-70">
<div>Lun</div><div>Mar</div><div>Mié</div><div>Jue</div><div>Vie</div><div>Sáb</div><div>Dom</div>
</div>
<div class="calendar-outer" id="calWrapper">
<div class="calendar-grid grid grid-cols-7 gap-2 p-2" id="calendario"></div>
</div>
</div>
<div class="legend mt-2 grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3 text-sm">
<div class="flex items-center gap-2"><span class="h-3 w-3 rounded ring-1 ring-black/10" style="background:#74d16b"></span><span>Franco</span></div>
<div class="flex items-center gap-2"><span class="h-3 w-3 rounded ring-1 ring-black/10" style="background:#65a0eb"></span><span>Franco por cambio</span></div>
<div class="flex items-center gap-2"><span class="h-3 w-3 rounded ring-1 ring-black/10" style="background:#b270d7"></span><span>Feriado</span></div>
<div class="flex items-center gap-2"><span class="h-3 w-3 rounded ring-1 ring-black/10" style="background:#ee6e4b"></span><span>Vacaciones</span></div>
<div class="flex items-center gap-2"><span class="h-3 w-3 rounded ring-1 ring-black/10" style="background:#75706f"></span><span>Licencia Sin Goce</span></div>
</div>
</section>
<!-- Cambios -->
<section class="grid md:grid-cols-2 gap-3 sm:gap-6 hidden reveal" id="panelCambios">
<div class="p-4 rounded-xl border card bg-white/90 backdrop-blur shadow">
<h3 class="font-semibold mb-3">Buscar Franco</h3>
<div class="flex flex-wrap items-end gap-3">
<label class="text-sm opacity-70">Quiero libre el</label>
<input class="px-2.5 py-1.5 rounded-xl border" disabled="" id="fecha" type="date"/>
<button class="px-2.5 py-1.5 rounded-xl bg-slate-900 text-white disabled:opacity-60" id="buscarFrancoBtn">Buscar</button>
</div>
<ul class="mt-4 space-y-2" id="francoList"></ul>
</div>
<div class="p-4 rounded-xl border card bg-white/90 backdrop-blur shadow">
<h3 class="font-semibold mb-3">Buscar Horario</h3>
<div class="flex flex-wrap items-end gap-3">
<label class="text-sm opacity-70">El día</label>
<input class="px-2.5 py-1.5 rounded-xl border" disabled="" id="fechaHorario" type="date"/>
<div class="flex items-center gap-2">
<label class="text-sm opacity-70">Ingreso</label>
<select class="px-2.5 py-1.5 rounded-xl border" disabled="" id="hora">
<option>-</option><option>06</option><option>07</option><option>08</option><option>09</option><option>10</option>
<option>11</option><option>12</option><option>13</option><option>14</option><option>15</option>
<option>16</option><option>17</option><option>18</option><option>19</option><option>20</option><option>21</option>
</select>
<select class="px-2.5 py-1.5 rounded-xl border" disabled="" id="min">
<option>-</option><option>00</option><option>30</option>
</select>
<span class="text-sm">hs</span>
</div>
<button class="px-2.5 py-1.5 rounded-xl bg-slate-900 text-white disabled:opacity-60" id="buscarHrBtn">Buscar</button>
</div>
<ul class="mt-4 space-y-2" id="hrList"></ul>
</div>
</section>
</main>
<script>
    const qs = id => document.getElementById(id);
    const calendario = qs('calendario');
    const panelCalendario = qs('panelCalendario');
    const panelCambios = qs('panelCambios');
    const state = { anio: 2025, horarios: [] };

    // Theme toggle
    
    (function initTheme(){
      // Force light theme always
      document.documentElement.classList.remove('dark');
      try{ localStorage.setItem('ui-theme','light'); }catch(e){}
      const lab = document.getElementById('themeLabel');
      const btn = document.getElementById('themeToggle');
      if(lab) lab.textContent = 'Claro';
      if(btn){ btn.setAttribute('disabled','disabled'); btn.style.opacity = .5; btn.style.cursor='not-allowed'; }
    })();
    

    // Compact mode on small iframes
    function applyCompact(){
      const w = document.documentElement.clientWidth;
      if(w <= 420) document.documentElement.classList.add('compact');
      else document.documentElement.classList.remove('compact');
    }
    applyCompact();
    window.addEventListener('resize', applyCompact);

    // Estados
    const ESTADOS = {
      franco:{label:"Franco",bg:"#74d16b",border:"#5fb357",fg:"#0b1c0a"},
      cambio:{label:"Franco por cambio",bg:"#65a0eb",border:"#4c86d0",fg:"#0b1420"},
      feriado:{label:"Feriado",bg:"#b270d7",border:"#9154b5",fg:"#1a0f23"},
      vacaciones:{label:"Vacaciones",bg:"#ee6e4b",border:"#cf5839",fg:"#2a110c"},
      lsg:{label:"Licencia Sin Goce",bg:"#75706f",border:"#5f5b5a",fg:"#0e0e0e"}
    };
    function clasificarEstado(contenido=""){
      const c=(contenido||"").toLowerCase();
      if(!c) return null;
      if(c.includes("lsg")) return ESTADOS.lsg;
      if(c.includes("vac")) return ESTADOS.vacaciones;
      if(c.includes("feriado")||c.includes("libre")) return ESTADOS.feriado;
      if(c.includes("cambio")) return ESTADOS.cambio;
      if(c.includes("franco")) return ESTADOS.franco;
      return null;
    }
    function pintarCeldaCompleta(el, estado){
      if(!estado) return;
      el.style.backgroundColor = estado.bg;
      el.style.borderColor = estado.border;
      el.style.color = estado.fg;
      el.dataset.colored = '1';   // marca como celda coloreada (no se oscurece en dark)
    }

    function obtenerDiasDelMes(mes, anio){ return new Date(anio, mes, 0).getDate(); }
    function ddm(fechaISO){ return `${fechaISO.slice(8,10)}/${fechaISO.slice(5,7)}`; }

    function setLoading(btn, loading=true){
      if(!btn) return;
      if(loading){
        btn.disabled = true;
        btn.innerHTML = `<svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="3" opacity=".15"/><path d="M21 12a9 9 0 0 0-9-9" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg><span class="ml-2">Cargando…</span>`;
      } else {
        btn.disabled = false;
        btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><span>Buscar</span>`;
      }
    }

    (function bootPlaceholders(){
      const input = qs('listaAgentesValor');
      input.value = "";
      input.disabled = true;
      input.placeholder = 'Seleccioná el mes…';
    })();

    async function cargarAgentes(){
      const mes = parseInt(qs('mes').value,10);
      const input = qs('listaAgentesValor');
      const dl = qs('listaAgentes');
      if(mes!==10 && mes!==11){
        input.disabled = true; input.placeholder = 'Seleccioná el mes…'; dl.innerHTML=''; return;
      }
      input.disabled = true; input.placeholder = 'cargando…';
      try{
        const res = await fetch(`/api/agentes?mes=${mes}`);
        const data = await res.json();
        dl.innerHTML='';
        (data.agentes||[]).forEach(n=>{ const opt=document.createElement('option'); opt.value=n; dl.appendChild(opt); });
        input.disabled=false; input.placeholder='Escribí un nombre…'; input.focus();
      }catch(e){ input.disabled=true; input.placeholder='Error al cargar. Reintentá el mes…'; }
    }

    function attachBounce(wrap){
      wrap.addEventListener('click', ()=>{
        wrap.classList.remove('pop'); void wrap.offsetWidth; wrap.classList.add('pop');
        setTimeout(()=>wrap.classList.remove('pop'), 320);
      });
    }

    function pintarCalendario(mes, horarios){
      calendario.innerHTML='';
      const primerDia = new Date(state.anio, mes - 1, 1).getDay();
      const totalDias = obtenerDiasDelMes(mes, state.anio);
      const indicePrimerDia = (primerDia === 0) ? 6 : primerDia - 1;

      const mapa = {};
      (horarios||[]).forEach(h => {
        const partes = (h||'').split(' ');
        const diaMes = partes[1] || '';
        const theContenido = partes.slice(2).join(' ');
        const diaNumero = parseInt((diaMes.split('-')[0]||'0'),10);
        if(!isNaN(diaNumero)) mapa[diaNumero] = theContenido;
      });

      for(let i=0;i<indicePrimerDia;i++){ calendario.appendChild(document.createElement('div')); }

      for(let d=1; d<=totalDias; d++){
        const wrap = document.createElement('div');
        // FIX: usar 'card' en vez de 'bg-white' para respetar el tema
        wrap.className='cell rounded border p-2 text-sm card';
        const head = document.createElement('div');
        head.className='text-xs mb-1 opacity-80';
        head.innerHTML=`<span class="font-medium">${d}</span>`;
        wrap.appendChild(head);

        const body = document.createElement('div');
        const cont = mapa[d];
        const estado = clasificarEstado(cont);
        if (estado) pintarCeldaCompleta(wrap, estado);

        wrap.addEventListener('click',(e)=>{
          const r = document.createElement('span');
          const size = 20;
          r.className = 'r';
          r.style.width = r.style.height = size + 'px';
          const rect = wrap.getBoundingClientRect();
          r.style.left = (e.clientX - rect.left - size/2) + 'px';
          r.style.top  = (e.clientY - rect.top  - size/2) + 'px';
          wrap.appendChild(r);
          wrap.classList.add('ripple');
          setTimeout(()=>{ wrap.classList.remove('ripple'); r.remove(); }, 500);
        });
        attachBounce(wrap);

        const hoy = new Date();
        if (hoy.getFullYear() === state.anio && (hoy.getMonth()+1) === mes && hoy.getDate() === d){ wrap.classList.add('today'); }

        if(cont){
          if(cont.includes(':')){
            const clean = cont.replaceAll('<div>','').replaceAll('</div>','').replaceAll('<br>',' ').replaceAll('<br/>',' ').replaceAll('<br />',' ').trim();
            const tokens = clean.split(' ').filter(t => t.includes(':'));
            if(tokens.length >= 2){
              const a = document.createElement('div'); a.className='text-[11px]'; a.textContent=tokens[0];
              const b = document.createElement('div'); b.className='text-[11px]'; b.textContent=tokens[1];
              body.append(a,b);
            } else { const p = document.createElement('div'); p.className='text-[11px]'; p.textContent=clean; body.appendChild(p); }
          } else {
            // Sin texto de estado: sólo color y fecha
            // (dejamos un espacio mínimo para no romper alturas)
            const spacer = document.createElement('div');
            spacer.style.minHeight = '2px';
            body.appendChild(spacer);
          }
        }

        wrap.appendChild(body); calendario.appendChild(wrap);
      }
    }

    function validar(){
      const agente = qs('listaAgentesValor').value.trim();
      const mes = qs('mes').value;
      return (!!agente && (mes==="10" || mes==="11"));
    }

    async function accionBuscar(){
      if(!validar()) return;
      setLoading(qs('btnBuscar'), true);
      try{
        const agente = qs('listaAgentesValor').value.trim();
        const mes = parseInt(qs('mes').value,10);
        const res = await fetch('/api/buscar',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({valorBuscado:agente, mes})});
        const dato = await res.json();
        if(!dato.ok){ alert(dato.error||'Error'); return; }
        qs('card_sup').textContent = dato.agente?.sup || '—';
        qs('card_score').textContent = dato.agente?.score || '—';
        qs('card_contrato').textContent = dato.agente ? `${dato.agente.horas||''}hs ${dato.agente.contrato||''}` : '—';
        state.horarios = dato.respuesta || [];
        pintarCalendario(mes, state.horarios);
        panelCalendario.classList.remove('hidden'); panelCambios.classList.remove('hidden');
        ['fecha','fechaHorario','hora','min','buscarFrancoBtn','buscarHrBtn'].forEach(id=>{ const el = qs(id); if(el) el.disabled = false; });
      } finally { setLoading(qs('btnBuscar'), false); }
    }

    async function buscarFrancos(){
      const agente = qs('listaAgentesValor').value.trim();
      const fechaISO = qs('fecha').value;
      if(!agente || !fechaISO){ alert('Elegí agente y fecha'); return; }
      const payload = { fecha: ddm(fechaISO), nombreAgente: agente };
      const btn = qs('buscarFrancoBtn'); const old = btn.innerText; btn.disabled = true; btn.innerText = 'Buscando…';
      try {
        const res = await fetch('/api/cambio/franco',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        const ul = qs('francoList'); ul.innerHTML='';
        (data.items||[]).forEach(it=>{
          const li = document.createElement('li');
          li.className = 'p-3 rounded-xl border card bg-white/70';
          const ha = it.horarioAnterior && it.horarioAnterior !== '-' ? ` (Antes: ${it.horarioAnterior})` : '';
          const hs = it.horarioSiguiente ? ` (Sig.: ${it.horarioSiguiente})` : '';
          li.textContent = `${it.agente} — ${it.sup}${ha}${hs}`; ul.appendChild(li);
        });
        if((data.items||[]).length===0){ const li=document.createElement('li'); li.className='p-8 rounded-xl border card bg-white/70 text-center'; li.textContent='Sin coincidencias'; ul.appendChild(li); }
      } finally { btn.disabled=false; btn.innerText=old; }
    }

    async function buscarHorarios(){
      const agente = qs('listaAgentesValor').value.trim();
      const fechaISO = qs('fechaHorario').value;
      const h = qs('hora').value; const m = qs('min').value;
      if(!agente || !fechaISO || h==='-' || m==='-'){ alert('Completá agente, fecha y hora'); return; }
      const payload = { fecha: ddm(fechaISO), nombreAgente: agente, hora: `${h}:${m}` };
      const btn = qs('buscarHrBtn'); const old = btn.innerText; btn.disabled = true; btn.innerText = 'Buscando…';
      try {
        const res = await fetch('/api/cambio/horario',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        const ul = qs('hrList'); ul.innerHTML='';
        (data.items||[]).forEach(it=>{
          const li = document.createElement('li'); li.className = 'p-3 rounded-xl border card bg-white/70';
          li.textContent = it.agente ? `${it.agente} — ${it.sup} (${it.horario})` : '—'; ul.appendChild(li);
        });
        if((data.items||[]).length===0){ const li=document.createElement('li'); li.className='p-8 rounded-xl border card bg-white/70 text-center'; li.textContent='Sin coincidencias'; ul.appendChild(li); }
      } finally { btn.disabled=false; btn.innerText=old; }
    }

    qs('btnBuscar').addEventListener('click', accionBuscar);
    qs('mes').addEventListener('change', cargarAgentes);
    qs('buscarFrancoBtn').addEventListener('click', buscarFrancos);
    qs('buscarHrBtn').addEventListener('click', buscarHorarios);

    // Auto init si mes ya estaba seleccionado por caché/navegador
    document.addEventListener('DOMContentLoaded', ()=>{
      const v = parseInt(qs('mes').value, 10); if(v===10 || v===11){ cargarAgentes(); }
    });
  

// ==== Loader helpers =====
function showLoader(txt){
  const o = document.getElementById('loaderOverlay');
  const t = o.querySelector('.loader-text');
  if (txt) t.textContent = txt; else t.textContent = 'Cargando…';
  o.style.display = 'flex';
}
function hideLoader(){
  const o = document.getElementById('loaderOverlay');
  o.style.display = 'none';
}

// Replace any dark-mode toggles (no-op now)
function disableDarkMode(){ document.documentElement.classList.remove('dark'); }
disableDarkMode();

// Enhance cargarAgentes with loader + animations
const __orig_cargarAgentes = typeof cargarAgentes === 'function' ? cargarAgentes : null;
if (__orig_cargarAgentes){
  window.cargarAgentes = async function(){
    const hint = document.getElementById('hintMes'); if(hint) hint.remove();
    showLoader('Cargando agentes…');
    try {
      const r = await __orig_cargarAgentes();
      // animar contenedores
      requestAnimationFrame(()=>{
        document.querySelectorAll('.cell, .card, .badge, .table-row').forEach((el,i)=>{
          el.classList.add('fade-in'); el.style.animationDelay = (i*0.01)+'s';
        });
      });
      return r;
    } finally {
      hideLoader();
    }
  }
}

// (fetch override removed)}

// Botón Buscar con micro animaciones
</script>
<script>

// ==== Loader helpers (fixed block) =====
(function(){
  function showLoader(txt){
    const o = document.getElementById('loaderOverlay');
    if(!o) return;
    const t = o.querySelector('.loader-text');
    if (t) t.textContent = txt || 'Cargando…';
    o.style.display = 'flex';
  }
  function hideLoader(){
    const o = document.getElementById('loaderOverlay');
    if(!o) return;
    o.style.display = 'none';
  }
  window.showLoader = showLoader;
  window.hideLoader = hideLoader;

  // Disable dark mode, enforce light
  document.documentElement.classList.remove('dark');

  // Wrap cargarAgentes if exists
  const __orig_cargarAgentes = (typeof window.cargarAgentes === 'function') ? window.cargarAgentes : null;
  if(__orig_cargarAgentes){
    window.cargarAgentes = async function(){
      try{
        const hint = document.getElementById('hintMes'); if(hint) hint.remove();
        showLoader('Cargando agentes…');
        const r = await __orig_cargarAgentes();
        requestAnimationFrame(()=>{
          document.querySelectorAll('.cell, .card, .badge, .table-row').forEach((el,i)=>{
            el.classList.add('fade-in'); el.style.animationDelay = (i*0.01)+'s';
          });
        });
        return r;
      } finally { hideLoader(); }
    }
  }

  // Intercept fetch for heavy calls only
  const _fetch = window.fetch;
  window.fetch = async function(){
    showLoader('Cargando…');
    try{ return await _fetch.apply(this, arguments); }
    finally{ hideLoader(); }
  }

  // Button micro-anim after DOM ready
  document.addEventListener('DOMContentLoaded', ()=>{
    const b = document.getElementById('btnBuscar');
    if(b){ b.classList.add('btn-shine','float'); }
    // if a valid month already is selected, remove hint
    const m = document.getElementById('mes');
    if(m && (parseInt(m.value,10)===10 || parseInt(m.value,10)===11)){
      const hint = document.getElementById('hintMes'); if(hint) hint.remove();
    }
  });
})();

</script>
</body>
</html>
